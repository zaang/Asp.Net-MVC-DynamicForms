Asp.Net MVC  动态表单模板 计划
==============================

##一、计划背景 ##
最初的想法，找到一种动态操作的表单模型，替代现有的OA系统的表单生成器。
希望从Asp.Net Forms 模型 切换到  Asp.Net MVC 框架。
批量处理的复杂表单，完成增、删、改、查询等功能，这可能是一个比较复杂的工作。
通常这类表单的处理工作需要一个一个的单独处理，编制强类型的数据模型、控制器和视图/展现模板。

###1.1 现行系统运行机制###
 1.  定义表单,字段名把、标题、数据类型、展现格式、引用方法等
 - 在数据库中 生成数据表结构，建立对应的数据表
 - 定义展现规则，包括 编辑控件、引用关系、关联子表特征
 - 生成对应的 aspx 页面，根据表单定义实现数据查询功能

现行系统从表单定义开始，到自动建表，已经形成了一套较为完整的业务规则，这也是多年生产实践的成果。


###1.2 现行系统的问题###
现行系统运行基本正常，但效率比较低，无法适应大规模用户访问，页面响应等待时间较长，用户体验较差，另外无法实现多版本并行化。

1. 整体层次结构
- 系统分层结构不清晰。由于系统层次划分不清，导致在表示层（aspx）部分承担了太多的任务
- 性能问题, Web Service 技术本身的性能损失。Web Service 适合在系统边界提供外部系统的访问，而不适宜在内部大量使用。
- 分层不清导致无法抽象出中间体，导致无法产生页面生成模板这样的中间体用于缓存规则和提高性能
- 分层不清晰导致无法使用使用多级缓存技术

2. 版本控制，不支持多版本并行
3. 数据处理方式
 - 数据处理采用 .Net 2.0 框架中的 弱类型 DataSet/DataTable 作为数据容器。
这种方法具备相当的灵活性，可以容纳数据表的变化，并且能够动态绑定表示层。
 - DataSet 和XML数据本身是想通的，即可以从 DataSet转换为XML ，同时也可以由DataSet 对象读取 XML数据完成数据集填充。
所以可以说实际上使用的是XML的一个变种，既可以严格限定数据字段也可以随时容纳字段和结构的变化。
虽然DataSet 访问起来很快但是这种自由访问是需要代价的，比如数据集中的检索速度取决于是否存在主键和索引，强类型的DataSet通常在填充阶段就已经准备好了主键索引，所以根据主键进行查找会非常快，而弱类型的DataSet就不会有这种优势。
 - 自定义的数据表还提供了一项优惠，即可以根据任意字段进行关联建立索引和视图，这一点是XML无法提供的。

###1.3 多版本并行问题###
多版本问题一直影响产品的实施，在产品的生命周期中，一个表单会进行多次修改，虽然这些修改不会有太多的改变，但是每一次都需要小心翼翼的修订和验证很多地方。
如果采用XML结构进行处理，每个表单都是独立的结构，映射到对应版本的展现模板，表单存档后内容自包含引用数据，数据状态得到保留，代码表更新不会影响存档数据。
关系型数据库的约束规则会优化存储空间，提高查询性能，但是愈来愈复杂的关联结构无法用外键表示，表结构也会不断变化，这势必导致系统的整体退化，长期运营的结果必然是补丁摞补丁，难以维护。

###1.4 需要解决的问题优先级###
综上所述，新的模型需要解决的问题优先级别
1. 多版本并行
2. 中间体/显示模板
3. 索引和查询功能

##二、Web 表单模型 ##
1. Web 表单模型
 - 模型定义
 - 数据存储模型
 - 视图模型 （View Model ）
 - 业务规则
 - 关联数据、外部引用
 - 数据展现模板（新增模板、编辑模板、列表模板、明细查看模板、打印输出模板（Web 打印））
 - 数据验证规则
 - 数据过滤规则
！分得这么详细，让我想起了 Share Point

- 表单数据处理业务逻辑包括
 - 版本控制
 - 模板定义
 - 视图模板自动生成
 - 流程控制
 - 工作流集成 （各个业务处理环节需要的数据各不相同，数据展现和 View Model 也不同）



> Written with [StackEdit](https://stackedit.io/).